(function () {
  let currentIndex = 0;
  let isWaitingForLoad = false;
  let isPaused = false;

  const getItems = () => Array.from(document.querySelectorAll('article.item-list'));

  // Toggle pause/resume with Space or "P"
  const toggleScroll = () => {
    isPaused = !isPaused;
    console.log(isPaused ? '‚è∏Ô∏è Auto-scroll paused.' : '‚ñ∂Ô∏è Auto-scroll resumed.');
  };

  document.addEventListener('keydown', (e) => {
    if (e.key === ' ' || e.key.toLowerCase() === 'p') {
      toggleScroll();
    }
  });

  const scrollNext = () => {
    if (isPaused) {
      console.log('‚è∏Ô∏è Scroll is paused.');
      return;
    }

    const loader = document.querySelector('#ctis-loading');

    // If loader is visible, wait
    if (loader && getComputedStyle(loader).display === 'block') {
      console.log('‚è≥ Loader is active... waiting.');
      isWaitingForLoad = true;
      return;
    }

    // Loader finished
    if (isWaitingForLoad && loader && getComputedStyle(loader).display === 'none') {
      isWaitingForLoad = false;
      console.log('‚úÖ Loader finished. Resuming scroll.');
    }

    const items = getItems();

    if (currentIndex < items.length) {
      const item = items[currentIndex];
      item.scrollIntoView({ behavior: 'smooth', block: 'center' });
      console.log(`üìú Scrolled to article ${currentIndex + 1} of ${items.length}`);
      currentIndex++;
    } else {
      if (loader && getComputedStyle(loader).display === 'none') {
        console.log('üïê Waiting for more articles to load...');
        isWaitingForLoad = true;
      } else {
        console.log('‚úÖ All articles scrolled. Stopping.');
        clearInterval(window.articleScrollInterval);
      }
    }
  };

  window.articleScrollInterval = setInterval(scrollNext, 5000);
  console.log('üöÄ Auto-scroll started for <article class="item-list">. Press Spacebar or "P" to pause/resume.');
})();
